document.addEventListener('DOMContentLoaded',function(){const e=document.getElementById('fahrenheit'),t=document.getElementById('celsius-result'),n=document.getElementById('copy-btn'),o=document.getElementById('validation-message'),r=document.getElementById('history-list'),i=document.getElementById('clear-history'),a=document.getElementById('empty-history-message'),s=document.getElementById('step1-viz'),l=document.getElementById('step2-viz'),c=document.getElementById('step3-viz'),u=document.querySelector('.mobile-menu-toggle'),d=document.querySelector('.nav-links'),p=document.querySelectorAll('.faq-item');const m=-459.67,f=1e6,h=10,v='fahrenheitToCelsiusHistory';function g(){const e=localStorage.getItem(v);return e?JSON.parse(e):[]}function b(){const e=g();r.innerHTML='';e.forEach((t,n)=>{const o=document.createElement('li');o.innerHTML=`<span>${t.fahrenheit}°F = ${T(t.celsius)}</span><span class="history-time">${k(new Date(t.timestamp))}</span>`;r.appendChild(o)})}function w(){if(g().length===0)return;confirm('Are you sure you want to clear your conversion history?')&&(localStorage.removeItem(v),b(),y())}function y(){g().length===0?(a.classList.remove('sr-only'),r.innerHTML='<li class="history-empty">No conversions yet</li>'):a.classList.add('sr-only')}function T(e){const t=Math.round(e*10)/10;if(e<0&&e>-1)return t.toFixed(1)+'°C';if(t%1===0)return t.toString()+'°C';return t.toFixed(1)+'°C'}function k(e){const t=new Date,n=Math.floor((t-e)/1e3);if(n<60)return'Just now';const o=Math.floor(n/60);if(o<60)return`${o} min ago`;const r=Math.floor(o/60);if(r<24)return`${r} hr ago`;const i=Math.floor(r/24);return i<7?`${i} day${i!==1?'s':''} ago`:e.toLocaleDateString()}function x(){const e=u.getAttribute('aria-expanded')==='true';u.setAttribute('aria-expanded',!e);d.classList.toggle('active')}function C(e){const t=e.classList.contains('active');p.forEach(e=>{e.classList.remove('active')});t||e.classList.add('active')}function E(e,t){o.textContent=t;o.classList.add(e)}function S(){s.textContent='';l.textContent='';c.textContent=''}function j(e){return(e-32)*5/9}function O(e,t){const n=e-32,o=n*5/9;s.textContent=`${e} - 32 = ${n.toFixed(2)}`;l.textContent=`${n.toFixed(2)} × 5/9 = ${o.toFixed(2)}`;c.textContent=`Result: ${T(t)}`}function F(e,t){let n=g(),o=new Date().toISOString(),r={fahrenheit:e,celsius:t,timestamp:o};n.unshift(r);n.length>h&&(n=n.slice(0,h));localStorage.setItem(v,JSON.stringify(n));b();y()}function D(){if(t.textContent==='--')return;navigator.clipboard.writeText(t.textContent).then(()=>{const e=n.querySelector('.btn-text').textContent;n.querySelector('.btn-text').textContent='Copied!';n.style.backgroundColor='#27ae60';setTimeout(()=>{n.querySelector('.btn-text').textContent=e;n.style.backgroundColor=''},2e3)}).catch(e=>{console.error('Failed to copy: ',e);alert('Failed to copy to clipboard. Please try again.')})}function A(){const n=parseFloat(e.value);o.textContent='';o.classList.remove('error','success');if(e.value===''){t.textContent='--';S();return}if(isNaN(n)){E('error','Please enter a valid number');t.textContent='--';S();return}if(n<m){E('error',`Temperature cannot be below absolute zero (${m}°F)`);t.textContent='--';S();return}if(n>f){E('error',`Temperature cannot exceed ${f.toLocaleString()}°F`);t.textContent='--';S();return}const r=j(n);t.textContent=T(r);O(n,r);F(n,r);if(n===32)E('success','Water freezes at 32°F (0°C)');else if(n===212)E('success','Water boils at 212°F (100°C)');else if(n===-40)E('success','-40°F equals -40°C (the scales meet here!)');else if(n===98.6)E('success','Normal human body temperature is approximately 98.6°F (37°C)')}b();y();e.addEventListener('input',A);n.addEventListener('click',D);i.addEventListener('click',w);u.addEventListener('click',x);p.forEach(e=>{const t=e.querySelector('.faq-question');t.addEventListener('click',()=>C(e))});document.addEventListener('click',function(e){d.classList.contains('active')&&!e.target.closest('.nav-links')&&!e.target.closest('.mobile-menu-toggle')&&x()});document.querySelectorAll('.info-btn').forEach(e=>{e.addEventListener('click',function(t){t.stopPropagation();const n=this.getAttribute('data-tooltip');if(n){document.querySelectorAll('.tooltip').forEach(e=>e.remove());const o=document.createElement('div');o.className='tooltip';o.textContent=n;const r=this.getBoundingClientRect();o.style.position='fixed';o.style.top=(r.top-40)+'px';o.style.left=(r.left+r.width/2-100)+'px';o.style.width='200px';document.body.appendChild(o);const i=function(){o.remove();document.removeEventListener('click',i)};setTimeout(i,3e3);document.addEventListener('click',i)}})});setTimeout(()=>{if(g().length===0){const e=[32,212,68,98.6,0,350];e.forEach(e=>F(e,j(e)))}},1e3);document.addEventListener('keydown',function(t){if(t.key==='/'&&t.target!==e){t.preventDefault();e.focus()}if(t.key==='Escape'&&document.activeElement===e){e.value='';t.textContent='--';S();o.textContent='';o.classList.remove('error','success')}});if('serviceWorker' in navigator)window.addEventListener('load',function(){navigator.serviceWorker.register('/sw.js').then(function(e){console.log('ServiceWorker registration successful with scope: ',e.scope)}).catch(function(e){console.log('ServiceWorker registration failed: ',e)})})});